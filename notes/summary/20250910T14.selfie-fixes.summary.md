# Selfie Upload Feature Fixes and Improvements
Date: 2025-09-10
Session: Fixing selfie upload issues and improving mobile UX

## What Was Fixed

Addressed multiple issues with the selfie upload feature after initial testing, focusing on mobile usability and proper Cloudinary integration.

### Key Fixes Implemented

1. **Android Camera Access**
   - **Problem**: Camera option not appearing on Android phones when selecting "Local files"
   - **Cause**: `clientAllowedFormats` parameter blocks camera access on Android 14+
   - **Solution**: Removed `clientAllowedFormats`, rely on server-side `resourceType: 'image'` validation

2. **Widget Cancel Bug**
   - **Problem**: Canceling upload widget left page in broken state (no UI visible)
   - **Cause**: Setting state to 'uploading' but never resetting on cancel
   - **Solution**: Removed unnecessary 'uploading' state, widget stays modal over current page

3. **State Management Refactor**
   - **Old states**: initial → uploading → confirming → done
   - **New states**: preparing → ready → options → done
   - **Benefit**: Clearer naming, proper loading state, no intermediate widget state

4. **Mobile UX Improvements**
   - Combined statement and upload button into single clickable card
   - Hide header during options/done states to save space
   - Reduced vertical spacing by ~50% throughout
   - Inline email input: "Please add [your@email.com]"
   - Removed redundant "skip email" link

5. **Cloudinary Moderation**
   - **Problem**: Photos not appearing in Moderation tab
   - **Cause**: `moderation: 'manual'` isn't a valid widget parameter
   - **Solution**: Configure moderation in upload preset via Cloudinary dashboard
   - Simplified folder structure: `test_prototype/` without `/pending` subfolder

### UI Changes

- **Title**: Changed to "Facing AI Danger" (using "face" as verb)
- **Widget theming**: PauseAI orange (#ff9416) instead of red
- **Fonts**: Roboto Slab and Saira Condensed to match site
- **Email messaging**: Clearer rationale - helps verify real supporters + notification

## Technical Decisions

### Widget as Black Box
- Don't track widget state internally
- Let it be a modal overlay
- Only react to success/close events

### Cloudinary Structure
- Use built-in moderation system via upload preset
- Tags for categorization, not status
- Single folder without subfolders
- Moderation status handled by Cloudinary

## Current Status

### Working
- Mobile camera access on Android
- Proper state flow without cancel bug
- Compact mobile-friendly options screen
- Cloudinary moderation (when preset configured)
- Themed widget matching site design

### Configuration Required
- Upload preset must have moderation enabled in Cloudinary dashboard
- Not configurable via widget parameters

### Next Steps (Future Sessions)
- Finalize statement wording with comms team
- Consider separate page for campaign details
- Implement webhook for approved photos
- Collage generation pipeline

## Lessons Learned

1. **Always test on real devices** - Desktop Chrome doesn't replicate Android file picker behavior
2. **Read the actual docs** - Don't assume API parameters exist (moderation wasn't valid)
3. **Mobile space is precious** - Every pixel counts on small screens
4. **Simple state machines** - Avoid intermediate states that complicate flow
5. **Framework limitations** - Sometimes the third-party widget just has quirks (two-step camera flow)

The feature is now ready for wider testing with improved mobile support and proper moderation workflow.