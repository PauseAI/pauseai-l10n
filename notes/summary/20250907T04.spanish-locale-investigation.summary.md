# Spanish Locale Investigation Summary
2024-12-09T15:00

## Current Status

### Spanish Locale Working
The Spanish locale preview at https://deploy-preview-447--pauseai.netlify.app/es/ is now fully functional:
- ✅ Page content is translated (headings, body text)
- ✅ Navigation is translated ("Aprender", "Propuesta", etc.)
- ✅ Most UI elements translated
- ⚠️ Minor UI elements remain in English (theme button, some footer items)

### Resolution
The issue was the environment variable mismatch preventing proper compilation. After fixing `inlang-settings.ts` to use `L10N_OPENROUTER_API_KEY`, Spanish translations are properly compiled and displayed.

## Key Discoveries

### 1. Environment Variable Mismatch (FIXED)
- **Issue**: `scripts/inlang-settings.ts` used `TRANSLATION_OPENROUTER_API_KEY` (old name)
- **Reality**: All other scripts use `L10N_OPENROUTER_API_KEY` (new name)
- **Fix Applied**: Commit fd6eac2 to main, now using L10N_ consistently
- **Safety**: Production unaffected (has both vars, only builds English anyway)

### 2. Locale Testing Workflow
- Created branch `l10n-es` from main
- Added Spanish to `project.inlang/default-settings.js`
- Added `[context.l10n-es.environment]` to `netlify.toml` (wildcards don't work!)
- Draft PR #447 triggers Netlify preview builds
- Translations stored in `pr-447` branch of paraglide repo (not `l10n-es` as expected)

### 3. Build Process Complexity
- Local branch `l10n-es` → cage branch `l10n-es`
- Netlify PR preview → cage branch `pr-{number}`
- Spanish translations must be present in the cage branch for builds to work
- Local builds require pulling translations to l10n-cage directory

## Working Method Established

### Division of Knowledge
**Anthony knows**:
- System architecture and intended behavior
- History of what has worked before
- Local environment quirks
- Where issues might hide

**Claude can**:
- Trace through code systematically
- Spot inconsistencies
- Test with direct tools (curl, grep)
- Document findings

### Investigation Protocol
1. **Start with questions** - Anthony has context Claude lacks
2. **Validate assertions** - Trust but verify Anthony's model
3. **Use direct tools** - `curl` beats WebFetch for accuracy
4. **Test locally first** - `netlify serve` for faster iteration
5. **Consider all layers** - SSR vs client hydration differences

## Additional Issues Discovered

### Unlocalized Logo Link (FIXED)
- The logo in `src/routes/header.svelte` was hardcoded to `href="/"`
- Spanish users clicking the logo would return to English homepage
- Fixed by using `localizeHref("/")` instead
- Committed in 26a31f1

### L10ntamer Tool Limitations (Issue #448)
- Only runs with `prefix-all-locales` strategy (not standard `prefix`)
- Uses whitelist approach instead of general detection
- Only catches specific hardcoded patterns, misses "/" and new pages
- No tests for core link detection logic
- Created GitHub issue #448 to track needed improvements

## Lessons Learned

### About the System
- Netlify doesn't support wildcard context patterns
- Environment variable precedence: netlify.toml > UI config
- Paraglide compilation is separate from translation fetching
- Branch naming affects cage branch selection

### About Our Collaboration
- Anthony's "I think" often means "I'm pretty sure but verify"
- Build/deploy latency makes production testing slow
- Local reproduction is possible but requires careful env setup
- WebFetch tool adds unhelpful AI interpretation layer

## Environment Context
- Working directory: `/home/anthony/repos/pauseai-l10n/notes/references/pauseai-website`
- Current branch: `l10n-es` (tracks `origin/l10n-es`)
- Cage branches: 
  - `pr-447` (has Spanish translations for Netlify preview)
  - `l10n-es` (merged Spanish translations from pr-447, pushed to remote)
- Local `.env`: API key typically commented out for dry-run mode
- Netlify PR: #447 (draft, for volunteer testing)