# Force Mode Globbing Implementation and Translation Cleanup

**Date**: 2025-06-03
**Branch**: claude-the-project-is-in-notes/references/pauseai-website

## Summary

This session focused on improving the --force mode implementation for the l10n scripts by adding proper glob pattern support and cleaning up remaining "translation" terminology throughout the codebase.

## Key Accomplishments

### 1. Force Mode Glob Support
**Problem**: The existing --force implementation only supported simple patterns:
- Exact matches: `join.md`
- All files: `*`
- Simple prefix: `2024-*` (but not `2024-*.md`)

**Solution**: 
- Added `minimatch` as a direct dependency (v9 for Node 18 compatibility)
- Created a dedicated `force.ts` module with clean separation of concerns
- Replaced custom pattern matching with standard glob support

**Now Supported**:
- Standard wildcards: `*.md`, `2024-*.md`
- Character classes: `202[34]-*.md`
- Brace expansion: `{join,donate,learn}.md`
- All minimatch glob features except negation patterns

### 2. Test-Driven Development Process
Followed Red-Green-Refactor methodology:
- **RED**: Created comprehensive tests expecting glob support, watched them fail
- **GREEN**: Implemented minimatch-based solution
- **REFACTOR**: Extracted force logic into dedicated module, cleaned up code

Created `force.test.ts` with integration tests that:
- Verify known files exist in the filesystem
- Test pattern resolution against real files
- Document unsupported features (negation patterns)

### 3. Translation → L10n Terminology Migration
Systematically replaced "translation" references with "l10n" throughout:
- `filesToTranslate` → `filesToLocalize`
- `TRANSLATION SUMMARY` → `L10N SUMMARY`
- `retranslation` → `re-l10n`
- `TRANSLATION_BRANCH` → `L10N_BRANCH`
- `translationOptions` → `l10nOptions`
- Parameter names and comments in utils.ts

Used sed commands for consistent replacement across files.

### 4. Bug Fixes
- Fixed `l10nOptions is not defined` error in run.ts
- Fixed minimist parsing issue where `--force en.json` was treating `en.json` as the value of force flag
- Updated help text to reflect new glob capabilities
- Fixed Mode tests that were using `TranslationMode` instead of `Mode`

## Technical Details

### Force Module Structure
```typescript
// force.ts
export async function resolve(
  patterns: string[],
  markdownSource: string
): Promise<string[]>
```
- Loads source files (en.json + markdown files)
- Uses minimatch for pattern matching
- Returns deduplicated results

### Minimist Configuration
```typescript
const argv = minimist(process.argv.slice(2), {
  boolean: ['dryRun', 'verbose', 'force']
})
```
- Ensures --force is parsed as boolean flag
- Allows patterns as positional arguments

### Test Architecture
- Integration tests use actual filesystem
- No mocking of glob functionality
- Tests verify expected behavior, not implementation

## Dependencies Added
- `minimatch@9` (v10 requires Node 20+, we're on Node 18)
- `@types/minimatch@5.1.2`

## What Was NOT Done
- Negation patterns (`!*.md`) - not supported by minimatch out of the box
- We explicitly chose not to implement custom negation handling
- No changes to prompts.ts (excluded from terminology migration)

## Next Steps
The L10N_BRANCH_SAFETY_PLAN_v2.md and CLAUDE.md files should be updated to reflect:
1. ✅ Force mode now supports standard glob patterns
2. ✅ Most "translation" terminology has been migrated to "l10n"
3. Remaining work focuses on other aspects of the l10n workflow